{# Carte Témoignage harmonisée avec la carte Projet #}
{% set bg_image = testimonial.thumbnail ? testimonial.thumbnail.src('large') : assets_url ~ '/imgs/maison-toit.png' %}
<article class="projects__card projects__card--testimonial {{ testimonial.priority ? 'is-' ~ testimonial.priority.slug : '' }}" role="listitem"
                 itemscope itemtype="https://schema.org/Review"
                 style="background-image: url('{{ bg_image }}');">
    <meta itemprop="image" content="{{ bg_image }}" />
    <div class="projects__card-overlay" aria-hidden="true"></div>

    <div class="projects__card-content">
        <div class="projects__card-header">
            <span class="projects__card-type">Témoignage</span>
        </div>

        <div class="projects__card-info">
            {% if testimonial.client_company or testimonial.client_position %}
                <p class="projects__card-client">
                    {% if testimonial.client_position %}{{ testimonial.client_position }}{% endif %}
                    {% if testimonial.client_position and testimonial.client_company %} chez {% endif %}
                    {% if testimonial.client_company %}{{ testimonial.client_company }}{% endif %}
                </p>
            {% endif %}
            {% if testimonial.client_name %}
                <h3 class="projects__card-title" itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <span itemprop="name">{{ testimonial.client_name }}</span>
                </h3>
            {% endif %}
            {% if testimonial.content %}
                <p class="projects__card-description" itemprop="reviewBody">{{ testimonial.content|striptags|truncate(160) }}</p>
            {% endif %}
        </div>
    </div>

    <footer class="projects__card-footer">
        {# Lien prioritaire vers le projet lié s'il existe, sinon vers le témoignage #}
        {% set linked_url = testimonial.linked_project and testimonial.linked_project.link ? testimonial.linked_project.link : testimonial.link %}
        <a href="{{ linked_url }}" class="projects__card-link" itemprop="url" aria-label="Voir le projet lié à {{ testimonial.client_name }}">
            <span>Voir le projet</span>
            <svg class="projects__card-arrow" width="10" height="9" viewBox="0 0 10 9" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M1 4.5H9M9 4.5L5.5 1M9 4.5L5.5 8" stroke="#048B9A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </a>
    </footer>
</article>
