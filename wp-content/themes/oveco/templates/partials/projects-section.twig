{# Projects Section #}
<section class="projects-section" id="projets" itemscope itemtype="https://schema.org/ItemList">
    <div class="projects">
        <div class="projects__container">
        <header class="projects__header">
                <div class="projects__header-content">
                    <p class="projects__subtitle">Nos réalisations</p>
            <h2 class="projects__title" id="projets-title" itemprop="name">Ce sont plus que des projets, ce sont des collaborations</h2>
                    <p class="projects__description" itemprop="description">
                        Lorem ipsum dolor sit amet consectetur adipiscing elit semper dalar elementum tempus hac tellus libero
                    </p>
                    <a href="{{ site.url }}/works" class="projects__link" aria-label="Voir tous nos projets (page Réalisations)">
                        <span>En savoir plus</span>
                        <svg class="projects__link-arrow" width="10" height="9" viewBox="0 0 10 9" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M1 4.5H9M9 4.5L5.5 1M9 4.5L5.5 8" stroke="#048B9A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </a>
                </div>
                <div class="projects__navigation" role="navigation" aria-label="Navigation des projets">
                    <button class="projects__nav-btn projects__nav-btn--prev" aria-label="Projet précédent" type="button">
                        <svg width="11" height="21" viewBox="0 0 11 21" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M10 1L1 10.5L10 20" stroke="#FFFEF8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button class="projects__nav-btn projects__nav-btn--next" aria-label="Projet suivant" type="button">
                        <svg width="11" height="21" viewBox="0 0 11 21" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M1 1L10 10.5L1 20" stroke="#FFFEF8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </header>

            <div class="projects__grid" role="list" aria-labelledby="projets-title">
                {# Prépare une liste source: projects (si fourni par le contrôleur) sinon fallback depuis helper #}
                {% set source_projects = projects is defined and projects|length > 0 ? projects : [] %}
                {% if source_projects is empty and function('oveco_get_recent_projects') %}
                    {% set source_projects = function('oveco_get_recent_projects', 8) %}
                {% endif %}

                {% for p in source_projects %}
                    {% set primary_tag = p.tags is defined and p.tags ? p.tags|first.name : '' %}
                    {% set hero_img = function('get_post_meta', p.id, '_project_hero_image', true) %}
                    {% include 'partials/components/card.twig' with {
                        image: hero_img ?: (p.thumbnail ? p.thumbnail.src : (assets_url ~ '/imgs/maison-toit.png')),
                        type: primary_tag,
                        client: p.client ?? '',
                        title: p.title,
                        url: site.url ~ '/work/' ~ p.slug
                    } %}
                {% endfor %}
            </div>
        </div>
    </div>
</section>
