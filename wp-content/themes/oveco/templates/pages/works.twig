{% extends "base.twig" %}

{% block content %}
<main class="works-page" id="works">
  {% include 'partials/works-hero.twig' with {
    id: 'works-hero-title',
    subtitle: 'Nos réalisations',
    title: 'Des projets qui ont du sens',
    desc: 'Explorez une sélection de réalisations menées avec nos clients: conception, autoconstruction, et énergies renouvelables.',
    cta: { label: 'Nous contacter', url: site.url ~ '#contact' },
    media_left: { src: assets_url ~ '/imgs/maison-toit.png', alt: 'Maison avec panneaux solaires' },
    media_right: { src: assets_url ~ '/imgs/maison-build.png', alt: 'Chantier de construction', overlay: true }
  } %}

  {# --- Section Recherche Projets (UI uniquement) --- #}
  {% macro tag_chip(label, selected=false) %}
    <button class="works-search__chip {{ selected ? 'is-selected' : '' }}" type="button" aria-pressed="{{ selected ? 'true' : 'false' }}" data-tag="{{ label }}">
      <span class="works-search__chip-label">{{ label }}</span>
    </button>
  {% endmacro %}
  {% import _self as ui %}

  <section class="works-search" aria-labelledby="works-search-title" role="region">
    <div class="container works-search__container">
      <h2 class="visually-hidden" id="works-search-title">Rechercher des projets</h2>

      <div class="works-search__nav">
        <form class="works-search__form" role="search" aria-label="Recherche de projets" action="#" method="get" novalidate>
          <label class="works-search__label" for="works-search-input">Chercher un projet</label>
          <div class="works-search__control">
            <input id="works-search-input" class="works-search__input" name="q" type="search" placeholder="Chercher un projet" autocomplete="off" />
            <span class="works-search__icon" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="7.5" cy="7.5" r="6.75" stroke="#5C6D6F" stroke-width="1.5" />
                <path d="M12.375 12.375L16.5 16.5" stroke="#5C6D6F" stroke-width="1.5" stroke-linecap="round" />
              </svg>
            </span>
          </div>
        </form>

        {# Tags dynamiques (depuis le contexte si fourni) #}
        {% set tag_labels = project_tags is defined and project_tags|length > 0
          ? project_tags
          : [] %}
        <div class="works-search__tags" role="list" aria-label="Filtrer par compétence">
          {% for t in tag_labels %}
            {{ ui.tag_chip(t) }}
          {% endfor %}
        </div>
      </div>

      {# Grille des projets (2 par ligne). Utilise card.twig, uniquement via DB #}
      {% set items = cards is defined and cards|length > 0 ? cards : [] %}

    <div class="works-search__grid" role="list" aria-label="Résultats de projets" id="works-results">
        {% for c in items %}
          {% set item_tags = [] %}
          {% if c.type %}{% set item_tags = item_tags|merge([c.type]) %}{% endif %}
          {% if c.client %}{% set item_tags = item_tags|merge([c.client]) %}{% endif %}
      <div class="works-search__grid-item" data-tags="{{ item_tags|join(' | ') }}">
            {% include 'partials/components/card.twig' with {
              image: c.image,
              type: c.type,
              client: c.client,
              title: c.title,
              url: c.url
            } %}
          </div>
        {% endfor %}
      </div>

    </div>
  </section>

  {# JS déplacé dans assets: src/js/works.js (enqueued conditionnellement) #}

    {# section contact #}
    {% include "partials/contact-section.twig" %}

</main>
{% endblock %}
