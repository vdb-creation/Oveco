{% extends "base.twig" %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1 class="page-header__title">{{ title }}</h1>
        {% if subtitle %}
            <p class="page-header__subtitle">{{ subtitle }}</p>
        {% endif %}
    </div>
</section>

<section class="testimonials-archive">
    <div class="container">
        {# Filtres #}
        <div class="testimonials-filters">
            <div class="filters-group">
                <label for="priority-filter">Filtrer par priorité :</label>
                <select id="priority-filter" class="filter-select">
                    <option value="">Toutes les priorités</option>
                    {% for priority in priorities %}
                        <option value="{{ priority.slug }}">{{ priority.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filters-group">
                <label for="project-filter">Filtrer par projet :</label>
                <select id="project-filter" class="filter-select">
                    <option value="">Tous les projets</option>
                    {% for project in projects %}
                        <option value="{{ project.ID }}">{{ project.post_title }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <button id="reset-filters" class="btn btn--secondary">Réinitialiser</button>
        </div>
        
        {# Grille de témoignages #}
        {% if testimonials %}
            <div class="testimonials-grid" id="testimonials-container">
                {% for testimonial in testimonials %}
                    <div class="testimonial-wrapper" 
                         data-priority="{{ testimonial.priority ? testimonial.priority.slug : 'none' }}"
                         data-project="{{ testimonial.linked_project_id ? testimonial.linked_project_id : 'none' }}">
                        {% include 'partials/testimonial-card.twig' with {
                            'testimonial': testimonial,
                            'show_project': true,
                            'show_rating': true
                        } %}
                    </div>
                {% endfor %}
            </div>
            
            {# Pagination #}
            {% if pagination %}
                <nav class="pagination-wrapper">
                    {{ pagination }}
                </nav>
            {% endif %}
        {% else %}
            <div class="no-testimonials">
                <h2>Aucun témoignage trouvé</h2>
                <p>Il n'y a actuellement aucun témoignage publié.</p>
            </div>
        {% endif %}
    </div>
</section>

{# Section CTA #}
<section class="testimonials-cta">
    <div class="container">
        <div class="cta-content">
            <h2>Vous aussi, partagez votre expérience</h2>
            <p>Vous avez travaillé avec nous ? Nous serions ravis de recueillir votre témoignage.</p>
            <a href="/contact" class="btn btn--primary">Nous contacter</a>
        </div>
    </div>
</section>

<script>
// Filtrage côté client pour les témoignages
document.addEventListener('DOMContentLoaded', function() {
    const priorityFilter = document.getElementById('priority-filter');
    const projectFilter = document.getElementById('project-filter');
    const resetButton = document.getElementById('reset-filters');
    const container = document.getElementById('testimonials-container');
    const testimonials = container.querySelectorAll('.testimonial-wrapper');
    
    function filterTestimonials() {
        const selectedPriority = priorityFilter.value;
        const selectedProject = projectFilter.value;
        
        testimonials.forEach(testimonial => {
            const testimonialPriority = testimonial.dataset.priority;
            const testimonialProject = testimonial.dataset.project;
            
            let showPriority = !selectedPriority || testimonialPriority === selectedPriority;
            let showProject = !selectedProject || testimonialProject === selectedProject;
            
            if (showPriority && showProject) {
                testimonial.style.display = 'block';
                testimonial.classList.add('fade-in');
            } else {
                testimonial.style.display = 'none';
                testimonial.classList.remove('fade-in');
            }
        });
    }
    
    priorityFilter.addEventListener('change', filterTestimonials);
    projectFilter.addEventListener('change', filterTestimonials);
    
    resetButton.addEventListener('click', function() {
        priorityFilter.value = '';
        projectFilter.value = '';
        filterTestimonials();
    });
});
</script>
{% endblock %}
