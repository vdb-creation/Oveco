---
/**
 * Composant: Certifications
 * Section de certifications avec cartes numérotées
 * Compatible TinaCMS via props
 */

export interface CertificationCard {
  logo?: string;   // TinaCMS field: chemin logo
  image?: string;  // Legacy field
  alt?: string;
  title?: string;  // TinaCMS field: titre certification
  text?: string;   // TinaCMS field: description
}

export interface Props {
  title?: string;
  description?: string;
  cards?: CertificationCard[];
  sectionIndex?: number;
}

const {
  title = "Des certifications à l'échelle européenne",
  description = "Notre savoir-faire est reconnu à l'échelle belge et européenne.<br>Nos projets respectent les normes en vigueur (PEB, RGIE…) et s'inscrivent dans une logique de transition énergétique cohérente, mesurable et durable.",
  sectionIndex = 0,
  cards = [{}, {}, {}] // 3 cartes par défaut
} = Astro.props;

// Normaliser les chemins d'images TinaCMS
function normalizePath(input?: string): string {
  if (!input) return '';
  let path = String(input).trim();
  if (!path) return '';
  if (/^(https?:)?\/\//i.test(path) || path.startsWith('data:')) return path;
  if (path.startsWith('/public/')) path = path.replace('/public/', '/');
  if (!path.startsWith('/')) path = '/' + path;
  return path;
}
---

<section class="certifications-section" id="certifications" aria-labelledby="certifications-title">
  <div class="certifications">
    <div class="certifications__container">
      <header class="certifications__header">
        <div class="certifications__header-content">
          <h2 class="certifications__title" id="certifications-title" data-bind={`sections.${sectionIndex}.title`} set:html={title} />
          <p class="certifications__description" data-bind={`sections.${sectionIndex}.description`} set:html={description} />
        </div>
      </header>

      <div class="certifications__row" role="list">
        {cards.map((card, index) => {
          const imageSrc = normalizePath(card.logo || card.image);
          const imageAlt = card.alt || card.title || `Certification ${index + 1}`;
          return (
            <article class="certifications__card" role="listitem" aria-label={card.title || `Certification ${index + 1}`}>
              <div class="certifications__card-bg" aria-hidden="true"></div>

              <div class="certifications__icon-wrap">
                {imageSrc ? (
                  <img 
                    src={imageSrc} 
                    alt={imageAlt} 
                    loading="lazy"
                    decoding="async"
                    class="certifications__icon-img" 
                  />
                ) : (
                  <span class="certifications__icon" aria-hidden="true"></span>
                )}
              </div>
              
              {card.text && (
                <p class="certifications__text" data-bind={`sections.${sectionIndex}.cards.${index}.text`}>{card.text}</p>
              )}
            </article>
          );
        })}
      </div>
    </div>
  </div>
</section>

<style>
/* CSS extrait de wp-content/themes/oveco/style.css (certifications) */
.certifications-section {
  align-self: stretch;
  background: #FFFEF8;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: clamp(48px, 8vw, 120px) clamp(16px, 8vw, 199px);
}

@media (max-width: 1200px) {
  .certifications-section {
    padding: 100px 120px;
  }
}

@media (max-width: 1024px) {
  .certifications-section {
    padding: 80px 80px;
  }
}

@media (max-width: 768px) {
  .certifications-section {
    padding: 60px 2rem;
  }
}

@media (max-width: 480px) {
  .certifications-section {
    padding: 50px 1rem;
  }
}

.certifications__container {
  display: flex;
  flex-direction: column;
  gap: 34px;
  align-items: center;
}

.certifications__header-content {
  width: 613.67px;
  max-width: 100%;
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
  text-align: center;
}

.certifications__title {
  color: #334749;
  font-size: 39.81px;
  font-family: "Nunito Sans Variable", "Nunito Sans", system-ui, -apple-system, sans-serif;
  font-weight: 800;
  line-height: 47.77px;
  margin: 0;
}

.certifications__description {
  color: #5C6D6F;
  font-size: 16px;
  font-family: "Nunito Sans Variable", "Nunito Sans", system-ui, -apple-system, sans-serif;
  font-weight: 400;
  line-height: 28.8px;
  margin: 0;
}

.certifications__row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 287px));
  gap: clamp(12px, 2.5vw, 21px);
  justify-content: center;
  width: 100%;
}

@media (max-width: 480px) {
  .certifications__row {
    display: flex;
    align-items: stretch;
    overflow-x: auto;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    gap: 14px;
    padding-bottom: 6px;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .certifications__row::-webkit-scrollbar {
    display: none;
    width: 0;
    height: 0;
  }
}

.certifications__card {
  width: 287px;
  min-height: 200px;
  height: auto;
  position: relative;
  border-radius: 24px;
  flex: 0 0 auto;
  z-index: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 24px 16px 20px;
  gap: 16px;
  background: #FFFEF8;
  border: 1px solid #5C6D6F;
}

@media (max-width: 480px) {
  .certifications__card {
    width: 80%;
    min-width: 260px;
  }
}

.certifications__card-bg {
  display: none;
}

.certifications__icon-wrap {
  position: relative;
  width: 96px;
  height: 96px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;
}

.certifications__icon {
  width: 32px;
  height: 28.2px;
  background: #5C6D6F;
  display: block;
}

.certifications__icon-img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

.certifications__text {
  position: relative;
  width: 100%;
  text-align: center;
  color: #334749;
  font-size: 13px;
  font-family: "Nunito Sans Variable", "Nunito Sans", system-ui, -apple-system, sans-serif;
  font-weight: 400;
  line-height: 1.5;
  margin: 0;
  z-index: 3;
}
</style>
