---
/**
 * Composant: TextImage
 * Composant réutilisable texte + image avec header de section optionnel
 * Compatible TinaCMS via props
 */

import SmartImage from './SmartImage.astro';

export interface Link {
  label: string;
  url: string;
}

export interface Image {
  src: string;
  alt: string;
  loading?: 'lazy' | 'eager';
}

export interface TextImageBlock {
  subtitle?: string;
  title?: string;
  description?: string;
  link?: Link;
  image?: Image;
}

export interface Props {
  // Header de section (centré)
  sectionSubtitle?: string;
  sectionTitle?: string;
  sectionDescription?: string;
  showSectionHeader?: boolean;
  
  // Premier bloc
  subtitle?: string;
  title?: string;
  description?: string;
  link?: Link;
  image?: Image;
  reverse?: boolean;
  
  // Second bloc (optionnel)
  duplicate?: boolean;
  subtitle2?: string;
  title2?: string;
  description2?: string;
  link2?: Link;
  image2?: Image;
}

const {
  sectionSubtitle,
  sectionTitle,
  sectionDescription,
  showSectionHeader = true,
  
  subtitle,
  title,
  description,
  link,
  image = {
    src: "/uploads/hero/maison-build.png",
    alt: "Réalisation Oveco"
  },
  reverse = false,
  
  duplicate = false,
  subtitle2,
  title2,
  description2,
  link2,
  image2
} = Astro.props;

// Sécuriser les objets image pour éviter les erreurs null/undefined
const safeImage = image || { src: "/uploads/hero/maison-build.png", alt: "Réalisation Oveco" };
const safeImage2 = image2 || safeImage;
---

<section class="oveco-section" itemscope itemtype="https://schema.org/Organization">
  <div class="container">
    
    {/* HEADER DE SECTION (centré) */}
    {showSectionHeader && (sectionSubtitle || sectionTitle || sectionDescription) && (
      <div class="oveco__section-header">
        <div class="oveco__section-content">
          {sectionSubtitle && <h3 class="oveco__section-subtitle">{sectionSubtitle}</h3>}
          {sectionTitle && <h2 class="oveco__section-title" set:html={sectionTitle} />}
          {sectionDescription && <p class="oveco__section-description" set:html={sectionDescription} />}
        </div>
      </div>
    )}
    
    {/* PREMIER BLOC */}
    <div class={`oveco__container ${reverse ? 'is-reverse' : ''}`}>
      {/* Contenu textuel */}
      <div class="oveco__content">
        {(subtitle || title || description) && (
          <header class="oveco__header">
            {subtitle && <h3 class="oveco__subtitle" itemprop="name">{subtitle}</h3>}
            {title && <h2 class="oveco__title" set:html={title} />}
            {description && <p class="oveco__description" itemprop="description" set:html={description} />}
          </header>
        )}
        
        {link && link.label && link.url && (
          <a href={link.url} class="oveco__link" aria-label={`En savoir plus sur ${subtitle || 'nos services'}`}>
            <span>{link.label}</span>
            <img src="/uploads/icons/Arrow.svg" alt="" class="oveco__arrow" aria-hidden="true" />
          </a>
        )}
      </div>

      {/* Zone visuelle */}
      <div class="oveco__visual">
        <SmartImage 
          cmsSrc={safeImage.src} 
          alt={safeImage.alt} 
          loading={safeImage.loading || 'lazy'} 
          width={362} 
          height={472} 
          class="oveco__main-image" 
          itemprop="image"
        />
        {Astro.props.icon1?.src && (
          <img src={Astro.props.icon1.src} alt={Astro.props.icon1.alt || ''} class="oveco__icon oveco__icon--house" aria-hidden="true" />
        )}
        {Astro.props.icon2?.src && (
          <img src={Astro.props.icon2.src} alt={Astro.props.icon2.alt || ''} class="oveco__icon oveco__icon--pencil" aria-hidden="true" />
        )}
      </div>
    </div>

    {/* SECOND BLOC (si duplicate) */}
    {duplicate && (
      <div class={`oveco__container ${!reverse ? 'is-reverse' : ''}`}>
        {/* Contenu textuel du 2e bloc */}
        <div class="oveco__content">
          {(subtitle2 || title2 || description2) && (
            <header class="oveco__header">
              {subtitle2 && <h3 class="oveco__subtitle" itemprop="name">{subtitle2}</h3>}
              {title2 && <h2 class="oveco__title" set:html={title2} />}
              {description2 && <p class="oveco__description" itemprop="description" set:html={description2} />}
            </header>
          )}
          
          {link2 && link2.label && link2.url && (
            <a href={link2.url} class="oveco__link" aria-label={`En savoir plus sur ${subtitle2 || 'nos services'}`}>
              <span>{link2.label}</span>
              <img src="/uploads/icons/Arrow.svg" alt="" class="oveco__arrow" aria-hidden="true" />
            </a>
          )}
        </div>

        {/* Zone visuelle du 2e bloc */}
        <div class="oveco__visual">
          <SmartImage 
            cmsSrc={safeImage2.src} 
            alt={safeImage2.alt} 
            loading={safeImage2.loading || 'lazy'} 
            width={362} 
            height={472} 
            class="oveco__main-image" 
            itemprop="image"
          />
          {Astro.props.icon1?.src && (
            <img src={Astro.props.icon1.src} alt={Astro.props.icon1.alt || ''} class="oveco__icon oveco__icon--house" aria-hidden="true" />
          )}
          {Astro.props.icon2?.src && (
            <img src={Astro.props.icon2.src} alt={Astro.props.icon2.alt || ''} class="oveco__icon oveco__icon--pencil" aria-hidden="true" />
          )}
        </div>
      </div>
    )}
  </div>
</section>

<style lang="scss">
  @use '../assets/scss/astro-components' as *;
</style>
