---
/**
 * Navbar Component - Oveco
 * Barre de navigation responsive avec menu mobile
 * 
 * @component
 */

export interface NavbarProps {
  logoUrl?: string;
  siteName?: string;
  siteUrl?: string;
  links?: Array<{
    label: string;
    url: string;
  }>;
  ctaButton?: {
    label: string;
    url: string;
  };
}

const {
  logoUrl = "/src/assets/imgs/logo/image.png",
  siteName = "Oveco",
  siteUrl = "/",
  links = [
    { label: "Qui sommes nous ?", url: "/about" },
    { label: "L'auto-construction", url: "/fr/construction" },
    { label: "Nos réalisations", url: "/works" }
  ],
  ctaButton = {
    label: "Nous contacter",
    url: "/#contact"
  }
} = Astro.props;
---

<nav class="navbar" id="navbar" role="navigation" aria-label="Navigation principale">
  <div class="navbar__container">
    <!-- Brand/Logo -->
    <a href={siteUrl} class="navbar__brand" aria-label={`${siteName} - Retour à l'accueil`}>
      <img 
        src={logoUrl} 
        alt={`Logo ${siteName}`}
        class="brand__logo-img" 
        width="45"
        height="45"
        loading="eager"
        fetchpriority="high"
        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
      />
      <div class="brand__text" style="display: none;" aria-hidden="true">
        {siteName}
      </div>
    </a>

    <!-- Navigation Menu -->
    <nav class="navbar__menu" id="navbarMenu" aria-label="Menu principal">
      <ul class="navbar__links" role="list">
        {links.map((link: { label: string; url: string }, index: number) => (
          <li role="listitem">
            <a 
              href={link.url} 
              class="navbar__link"
              aria-label={`Aller à ${link.label}`}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- CTA Button (dans le menu pour le mobile) -->
      <div class="navbar__cta">
        <a 
          href={ctaButton.url} 
          class="navbar__btn"
          aria-label={`${ctaButton.label} - Action principale`}
        >
          {ctaButton.label}
        </a>
      </div>
    </nav>

    <!-- Mobile Toggle -->
    <button 
      class="navbar__toggle" 
      id="navbarToggle" 
      type="button" 
      aria-label="Ouvrir le menu de navigation" 
      aria-controls="navbarMenu" 
      aria-expanded="false"
      aria-haspopup="true"
    >
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </button>
  </div>
</nav>

<!-- Overlay pour fermeture du menu sur mobile -->
<div class="navbar-overlay" id="navbarOverlay" hidden aria-hidden="true"></div>

<script>
// JavaScript pour le menu mobile et interactions
document.addEventListener('DOMContentLoaded', function() {
  const navbar = document.getElementById('navbar') as HTMLElement;
  const toggle = document.getElementById('navbarToggle') as HTMLButtonElement;
  const menu = document.getElementById('navbarMenu') as HTMLElement;
  const overlay = document.getElementById('navbarOverlay') as HTMLElement;
  const body = document.body;

  if (!navbar || !toggle || !menu || !overlay) return;

  // Toggle mobile menu
  toggle.addEventListener('click', function() {
    const willOpen = !toggle.classList.contains('active');
    toggle.classList.toggle('active');
    menu.classList.toggle('active');
    overlay.classList.toggle('active');
    overlay.hidden = !overlay.classList.contains('active');
    body.classList.toggle('no-scroll', willOpen);
    toggle.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
  });

  // Close mobile menu when clicking on a link
  menu.addEventListener('click', function(e: Event) {
    const target = e.target as HTMLElement;
    if (target.classList.contains('navbar__link')) {
      toggle.classList.remove('active');
      menu.classList.remove('active');
      overlay.classList.remove('active');
      overlay.hidden = true;
      body.classList.remove('no-scroll');
      toggle.setAttribute('aria-expanded', 'false');
    }
  });

  // Close when clicking overlay
  overlay.addEventListener('click', function() {
    toggle.classList.remove('active');
    menu.classList.remove('active');
    overlay.classList.remove('active');
    overlay.hidden = true;
    body.classList.remove('no-scroll');
    toggle.setAttribute('aria-expanded', 'false');
  });

  // Close on ESC
  window.addEventListener('keydown', function(e: KeyboardEvent) {
    if (e.key === 'Escape' && toggle.classList.contains('active')) {
      toggle.click();
    }
  });

  // Reset state on resize to desktop
  const mqDesktop = window.matchMedia('(min-width: 1025px)');
  const onResize = () => {
    if (mqDesktop.matches) {
      toggle.classList.remove('active');
      menu.classList.remove('active');
      overlay.classList.remove('active');
      overlay.hidden = true;
      body.classList.remove('no-scroll');
      toggle.setAttribute('aria-expanded', 'false');
    }
  };
  window.addEventListener('resize', onResize);
  mqDesktop.addEventListener?.('change', onResize);

  // Navbar scroll effect (optional)
  window.addEventListener('scroll', function() {
    if (window.scrollY > 50) {
      navbar.classList.add('scrolled');
    } else {
      navbar.classList.remove('scrolled');
    }
  });
});
</script>
<style>
/* Styles extraits de wp-content/themes/oveco/style.css (branche main) */
.navbar {
  position: absolute;
  z-index: 1000;
  width: 100%;
}

.navbar__container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 clamp(16px, 4vw, 32px);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  min-height: clamp(70px, 10vw, 80px);
}

/* Brand */
.navbar__brand { display: flex; align-items: center; gap: 0.75rem; text-decoration: none; }
.navbar__brand .brand__logo-img {
  height: clamp(35px, 4vw, 45px);
  width: auto;
  object-fit: contain;
  filter: drop-shadow(0 2px 4px rgba(51, 71, 73, 0.1));
}
.navbar__brand .brand__text { display: flex; flex-direction: column; gap: 0.25rem; }
.navbar__brand .brand__logo {
  color: #334749;
  font-family: "Nunito Sans Variable", "Nunito Sans", system-ui, -apple-system, sans-serif;
  font-weight: 600;
  font-size: clamp(1.5rem, 2.5vw, 2.195rem);
  line-height: 1;
  text-decoration: none;
}
.navbar__brand .brand__tagline {
  color: #048B9A;
  font-family: "Nunito Sans Variable", "Nunito Sans", system-ui, -apple-system, sans-serif;
  font-weight: 600;
  font-size: clamp(0.5rem, 1.2vw, 0.726rem);
  line-height: 1;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Menu */
.navbar__menu {
  display: flex;
  align-items: center;
  gap: clamp(16px, 3vw, 32px);
  list-style: none;
  margin: 0;
  padding: 0;
  flex: 1 1 auto;
  min-width: 0;
}

.navbar__links {
  display: flex;
  align-items: center;
  gap: clamp(16px, 3vw, 32px);
  margin-inline: auto;
  min-width: 0;
  list-style: none;
  padding: 0;
}

.navbar__links li {
  list-style: none;
  margin: 0;
  padding: 0;
}

.navbar__link {
  color: #5C6D6F;
  font-family: "Nunito Sans Variable", "Nunito Sans", system-ui, -apple-system, sans-serif;
  font-weight: 400;
  font-size: clamp(14px, 2.5vw, 16px);
  line-height: 1.5;
  text-decoration: none;
  white-space: nowrap;
  padding: clamp(8px, 1.5vw, 12px) clamp(4px, 1vw, 8px);
  border-radius: 6px;
  transition: all 0.2s ease;
}
.navbar__link:hover, .navbar__link:focus { color: #048B9A; background: rgba(2, 139, 154, 0.05); }
.navbar__link.active { color: #048B9A; font-weight: 600; background: rgba(2, 139, 154, 0.1); }

/* CTA */
.navbar__cta { display: flex; align-items: center; gap: clamp(8px, 2vw, 16px); }
.navbar__btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 14px 24px;
  background: #334749;
  border-radius: 30px;
  color: #FFFEF8;
  font-size: 16px;
  font-family: "Nunito Sans Variable", "Nunito Sans", system-ui, -apple-system, sans-serif;
  font-weight: 700;
  line-height: 1.4;
  text-align: center;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s ease;
}
.navbar__btn:hover { background: #048B9A; transform: translateY(-2px); box-shadow: 0 4px 16px rgba(51,71,73,0.12); }

/* Toggle (mobile) */
.navbar__toggle {
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: clamp(28px, 6vw, 32px);
  height: clamp(28px, 6vw, 32px);
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 0;
  z-index: 1002;
  border-radius: 4px;
  transition: background-color 0.2s ease;
}
.navbar__toggle:hover { background: rgba(2, 139, 154, 0.1); }
.navbar__toggle span { display: block; width: clamp(20px, 4vw, 24px); height: 2px; background: #334749; transform-origin: center; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
.navbar__toggle span:not(:last-child) { margin-bottom: clamp(4px, 1vw, 6px); }
.navbar__toggle.active span:nth-child(1) { transform: rotate(45deg) translateY(clamp(6px, 1.5vw, 8px)); }
.navbar__toggle.active span:nth-child(2) { opacity: 0; transform: scale(0); }
.navbar__toggle.active span:nth-child(3) { transform: rotate(-45deg) translateY(clamp(-6px, -1.5vw, -8px)); }
.navbar__toggle:hover span { background: #048B9A; }

/* Overlay mobile */
.navbar-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  backdrop-filter: blur(4px);
}
.navbar-overlay.active { opacity: 1; visibility: visible; }

/* Responsive */
@media (max-width: 768px) {
  .navbar__container { min-height: clamp(60px, 8vw, 70px); padding: 0 clamp(16px, 4vw, 24px); }
  .navbar__menu {
    position: fixed;
    top: clamp(60px, 8vw, 70px);
    left: 0; right: 0;
    background: #FFFEF8;
    flex-direction: column;
    padding: clamp(24px, 4vw, 32px) clamp(16px, 4vw, 24px) clamp(32px, 6vw, 48px);
    gap: clamp(20px, 4vw, 24px);
    transform: translateY(-100vh);
    opacity: 0; visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 8px 32px rgba(51, 71, 73, 0.15);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid rgba(51, 71, 73, 0.1);
  }
  .navbar__menu.active { transform: translateY(0); opacity: 1; visibility: visible; }
  .navbar__links { width: 100%; flex-direction: column; justify-content: flex-start; align-items: center; gap: clamp(16px, 3vw, 20px); margin: 0; }
  .navbar__link { font-size: clamp(16px, 3vw, 18px); padding: clamp(12px, 2vw, 16px) clamp(16px, 3vw, 24px); width: 100%; text-align: center; }
  .navbar__toggle { display: flex; }
  .navbar__cta { width: 100%; margin-top: clamp(16px, 3vw, 24px); justify-content: center; padding-top: clamp(16px, 3vw, 24px); border-top: 1px solid rgba(51, 71, 73, 0.1); }
}

@media (max-width: 480px) {
  .navbar__container { min-height: clamp(56px, 8vw, 64px); padding: 0 16px; }
  .navbar__menu { top: clamp(56px, 8vw, 64px); padding: clamp(20px, 4vw, 24px) 16px clamp(24px, 5vw, 32px); }
  .navbar__brand .brand__logo-img { height: 32px; }
}

@media (min-width: 1024px) {
  .navbar-overlay { display: none; }
}

/* Palier tablette: avant le burger, compacter l'espace */
@media (min-width: 769px) and (max-width: 1024px) {
  .navbar__container { padding: 0 clamp(16px, 3vw, 24px); }
  .navbar__links { gap: clamp(12px, 2vw, 20px); flex-wrap: wrap; justify-content: flex-end; }
  .navbar__link { font-size: clamp(13px, 1.8vw, 15px); padding: 8px 6px; }
  .navbar__btn { padding: 12px 18px; font-size: 15px; }
}
</style>