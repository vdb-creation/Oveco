---
import DynamicPage from '../components/DynamicPage.astro';
import Projects from '../components/Projects.astro';
import Contact from '../components/Contact.astro';

// Charger les données about.json
let aboutData: any = null;
try {
  const aboutModule = await import('../../content/about.json');
  aboutData = aboutModule.default;
} catch (e) {
  console.error('Erreur lors du chargement de about.json:', e);
}

const about = aboutData || {};
---

<!-- @ts-expect-error - Astro slots are not recognized as children by TypeScript -->
<DynamicPage 
  title={about.title || "À propos - Oveco"}
  description={about.description || "Découvrez l'histoire d'Oveco, notre équipe et nos valeurs."}
  jsonFile="about"
  lang="fr"
>
  <div class="about-page">
    <!-- Hero Section -->
    <section class="about-hero">
      <div class="container">
        <div class="about-hero__content">
          <h1 class="about-hero__title">{about.hero?.title || "Construire ensemble un habitat durable"}</h1>
          <p class="about-hero__subtitle">{about.hero?.subtitle || "Notre mission"}</p>
          <p class="about-hero__description">{about.hero?.description || "Chez Oveco, nous croyons que chacun peut devenir acteur de son habitat."}</p>
        </div>
        {about.hero?.image && (
          <div class="about-hero__image">
            <img src={about.hero.image} alt={about.hero.imageAlt || "Équipe Oveco"} />
          </div>
        )}
      </div>
    </section>

    <!-- Story Section -->
    {about.story && (
      <section class="about-story">
        <div class="container">
          <div class="about-story__content">
            <h2 class="about-story__title">{about.story.title}</h2>
            <div class="about-story__text" set:html={about.story.content?.split('\n').map(paragraph => 
              paragraph.trim() ? `<p>${paragraph}</p>` : ''
            ).join('')}></div>
          </div>
          {about.story.image && (
            <div class="about-story__image">
              <img src={about.story.image} alt={about.story.imageAlt || "Notre histoire"} />
            </div>
          )}
        </div>
      </section>
    )}

    <!-- Values Section -->
    {about.values && (
      <section class="about-values">
        <div class="container">
          <div class="about-values__header">
            <h2 class="about-values__title">{about.values.title}</h2>
            <p class="about-values__subtitle">{about.values.subtitle}</p>
          </div>
          <div class="about-values__grid">
            {about.values.items?.map((value: any) => (
              <div class="about-values__item">
                {value.icon && <img src={value.icon} alt={value.alt || value.title} class="about-values__icon" />}
                <h3 class="about-values__item-title">{value.title}</h3>
                <p class="about-values__item-description">{value.description}</p>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Team Section -->
    {about.team && (
      <section class="about-team">
        <div class="container">
          <div class="about-team__header">
            <h2 class="about-team__title">{about.team.title}</h2>
            <p class="about-team__subtitle">{about.team.subtitle}</p>
            <p class="about-team__description">{about.team.description}</p>
          </div>
          <div class="about-team__grid">
            {about.team.members?.map((member: any) => (
              <div class="about-team__member">
                {member.image && <img src={member.image} alt={member.imageAlt || member.name} class="about-team__photo" />}
                <h3 class="about-team__name">{member.name}</h3>
                <p class="about-team__role">{member.role}</p>
                <p class="about-team__description">{member.description}</p>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Stats Section -->
    {about.stats && (
      <section class="about-stats">
        <div class="container">
          <h2 class="about-stats__title">{about.stats.title}</h2>
          <div class="about-stats__grid">
            {about.stats.items?.map((stat: any) => (
              <div class="about-stats__item">
                <div class="about-stats__value">{stat.value}</div>
                <div class="about-stats__label">{stat.label}</div>
                <div class="about-stats__description">{stat.description}</div>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- CTA Section -->
    {about.cta && (
      <section class="about-cta">
        <div class="container">
          <h2 class="about-cta__title">{about.cta.title}</h2>
          <p class="about-cta__description">{about.cta.description}</p>
          <a href={about.cta.buttonUrl} class="about-cta__button">{about.cta.buttonText}</a>
        </div>
      </section>
    )}

    <!-- Section projets -->
    <Projects title="Nos Projets" />
    
    <!-- Section contact -->
    <Contact />
  </div>
</DynamicPage>

<style lang="scss">
  @use '../assets/scss/astro-components' as *;

  .about-page {
    // Styles spécifiques à la page about
  }

  .page-body {
    padding: var(--space-4) 0;
    
    &.is-gutenberg {
      max-width: 800px;
      margin: 0 auto;
    }
  }
</style>